# 本地模式测试清单

## 测试环境

- 前端：http://localhost:3000
- 后端：http://localhost:3001
- 数据库：SQLite（`backend/data/database.sqlite`）
- 存储：本地文件系统（`/Users/ahui/Desktop/nano-banana-images`）

## 测试账号

- 用户名：`admin`
- 密码：`123456`

---

## 1. 登录功能

### 1.1 正常登录
1. 打开 http://localhost:3000
2. 输入用户名 `admin`，密码 `123456`
3. 点击登录按钮
4. **预期结果**：成功进入画布页面

### 1.2 错误密码
1. 输入用户名 `admin`，密码 `wrong`
2. 点击登录按钮
3. **预期结果**：显示错误提示

---

## 2. 配置模态框显示

### 2.1 数据库配置
1. 登录后，点击顶部工具栏的数据库图标
2. **预期结果**：
   - 显示"本地 SQLite"
   - 显示数据库路径：`./data/database.sqlite`
   - 连接状态为"已连接"

### 2.2 存储配置
1. 点击顶部工具栏的云存储图标
2. **预期结果**：
   - 显示"本地存储"
   - 显示存储路径：`/Users/ahui/Desktop/nano-banana-images`
   - 显示服务器地址：`http://localhost:3001`

---

## 3. 图片生成与存储

### 3.1 生成图片
1. 在底部对话框输入提示词，如"一只可爱的猫咪"
2. 点击生成按钮
3. **预期结果**：
   - 画布上出现占位符
   - 生成完成后显示图片
   - 图片保存到本地存储目录

### 3.2 验证本地存储
1. 打开 Finder，进入 `/Users/ahui/Desktop/nano-banana-images`
2. **预期结果**：
   - 存在以日期命名的文件夹（如 `2026/01/08`）
   - 文件夹内有原图和缩略图（`*_thumb.webp`）

---

## 4. 图片显示

### 4.1 画布图片加载
1. 生成图片后，观察画布
2. **预期结果**：图片正常显示，无 CORS 错误

### 4.2 图片库
1. 点击顶部工具栏的图片库图标
2. **预期结果**：
   - 图片列表正常显示
   - 缩略图正常加载

### 4.3 添加为参考图
1. 右键点击画布上的图片
2. 选择"作为参考图"
3. **预期结果**：
   - 底部对话框显示参考图预览
   - 参考图图片正常显示

---

## 5. 画布交互

### 5.1 滚轮缩放
1. 将鼠标放在画布某个位置
2. 滚动鼠标滚轮
3. **预期结果**：
   - 以鼠标位置为中心缩放
   - 背景点阵同步跟随缩放
   - 缩放过程流畅，无跳跃

### 5.2 拖拽画布
1. 按住鼠标左键拖动画布空白区域
2. **预期结果**：
   - 画布平移
   - 背景点阵同步跟随移动

### 5.3 缩放按钮
1. 点击右下角的 + 或 - 按钮
2. **预期结果**：
   - 有丝滑的缩放动画
   - 背景点阵有过渡动画

### 5.4 原图/缩略图切换
1. 缩放到 80% 以下
2. **预期结果**：使用缩略图（控制台可见 `_thumb.webp` 请求）
3. 缩放到 80% 以上
4. **预期结果**：加载原图

---

## 6. 项目管理

### 6.1 切换项目
1. 点击顶部的项目切换器
2. 选择另一个项目（或创建新项目）
3. **预期结果**：画布显示对应项目的图片

### 6.2 图片位置保存
1. 拖动画布上的图片到新位置
2. 刷新页面（F5）
3. **预期结果**：图片位置保持不变

---

## 7. 回收站

### 7.1 删除图片
1. 右键点击画布上的图片
2. 选择"删除"
3. **预期结果**：图片从画布消失

### 7.2 查看回收站
1. 点击回收站图标
2. **预期结果**：显示已删除的图片

### 7.3 恢复图片
1. 在回收站中点击"恢复"
2. **预期结果**：图片重新出现在画布上

---

## 测试结果记录

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 1.1 正常登录 | ⬜ | |
| 1.2 错误密码 | ⬜ | |
| 2.1 数据库配置 | ⬜ | |
| 2.2 存储配置 | ⬜ | |
| 3.1 生成图片 | ⬜ | |
| 3.2 验证本地存储 | ⬜ | |
| 4.1 画布图片加载 | ⬜ | |
| 4.2 图片库 | ⬜ | |
| 4.3 添加为参考图 | ⬜ | |
| 5.1 滚轮缩放 | ⬜ | |
| 5.2 拖拽画布 | ⬜ | |
| 5.3 缩放按钮 | ⬜ | |
| 5.4 原图/缩略图切换 | ⬜ | |
| 6.1 切换项目 | ⬜ | |
| 6.2 图片位置保存 | ⬜ | |
| 7.1 删除图片 | ⬜ | |
| 7.2 查看回收站 | ⬜ | |
| 7.3 恢复图片 | ⬜ | |

---

## 常见问题排查

### 图片无法加载
1. 检查控制台是否有 CORS 错误
2. 确认后端已启动且 `/api/static-images` 路由正常
3. 检查 `LOCAL_STORAGE_PATH` 配置是否正确

### 登录失败
1. 确认数据库文件存在：`backend/data/database.sqlite`
2. 检查用户是否已创建：运行 `npm run manage-users list`

### 数据库连接失败
1. 确认 `DATABASE_MODE=sqlite` 已配置
2. 检查 `SQLITE_PATH` 路径是否正确
