# 📋 Nano Banana AI 配置指南

## 🎯 配置概述

您的 Nano Banana AI 应用支持三种主要配置：
1. **API 配置** - Nano Banana AI 服务配置
2. **数据库配置** - MySQL/PostgreSQL 数据库连接
3. **OSS 配置** - 阿里云对象存储服务

## 🖥️ 界面配置（推荐方式）

### 1. 📊 数据库配置

**步骤**：
1. 点击界面右上角的 **"数据库"** 按钮
2. 填写数据库连接信息
3. 点击 **"测试连接"** 验证配置
4. 点击 **"连接"** 建立连接
5. 点击 **"初始化数据库"** 创建表结构

**配置参数**：
```
主机地址: your-database-host.com
端口: 3306 (MySQL) / 5432 (PostgreSQL)
数据库名: nano_banana_ai
用户名: your_username
密码: your_password
SSL: ✅ 启用（推荐）
```

**阿里云 RDS 示例**：
```
主机地址: rm-xxxxxxxx.mysql.rds.aliyuncs.com
端口: 3306
数据库名: nano_banana_ai
用户名: your_rds_username
密码: your_rds_password
SSL: ✅ 启用
```

### 2. 🔑 API 配置

**步骤**：
1. 点击界面右上角的 **"API 配置"** 按钮
2. 填写 Nano Banana API 信息
3. 点击 **"测试连接"** 验证 API 密钥
4. 点击 **"保存"** 保存配置

**配置参数**：
```
API Key: your_nano_banana_api_key
API 地址: https://grsai.dakka.com.cn/v1/draw
提供商: Nano Banana
超时时间: 300000 (5分钟)
重试次数: 3
```

### 3. ☁️ OSS 云存储配置

**步骤**：
1. 点击 **"云存储"** 卡片中的 **"点击配置 →"**
2. 选择阿里云区域
3. 填写 OSS 配置信息
4. 点击 **"测试连接"** 验证配置
5. 启用 OSS 存储并保存

**配置参数**：
```
区域: 华南1（深圳）
存储桶名称: your-bucket-name
Access Key ID: your_access_key_id
Access Key Secret: your_access_key_secret
Endpoint: https://oss-cn-shenzhen.aliyuncs.com
自定义域名: https://your-domain.com (可选)
启用 OSS: ✅
```

## 🔧 环境变量配置（高级用户）

如果您需要通过代码配置，可以编辑 `backend/.env` 文件：

```bash
# 后端服务配置
PORT=3002
NODE_ENV=development
FRONTEND_URL=http://localhost:3000

# Nano Banana AI API 配置
NANO_BANANA_API_KEY=your_api_key_here
NANO_BANANA_API_URL=https://grsai.dakka.com.cn/v1/draw

# 数据库配置
DB_HOST=your-database-host.com
DB_PORT=3306
DB_DATABASE=nano_banana_ai
DB_USERNAME=your_username
DB_PASSWORD=your_password
DB_SSL=true

# 阿里云 OSS 配置
OSS_REGION=oss-cn-shenzhen
OSS_BUCKET=your-bucket-name
OSS_ACCESS_KEY_ID=your_access_key_id
OSS_ACCESS_KEY_SECRET=your_access_key_secret
OSS_ENDPOINT=https://oss-cn-shenzhen.aliyuncs.com

# 安全配置
ENCRYPTION_KEY=your-32-character-encryption-key-here
```

## 📝 详细配置说明

### 🗄️ 数据库配置详解

**支持的数据库**：
- MySQL 5.7+
- MySQL 8.0+
- PostgreSQL 12+
- 阿里云 RDS MySQL
- 阿里云 RDS PostgreSQL

**连接要求**：
- 数据库用户需要有 CREATE、SELECT、INSERT、UPDATE、DELETE 权限
- 建议启用 SSL 连接以提高安全性
- 确保防火墙允许应用服务器访问数据库端口

**表结构**：
应用会自动创建以下表：
- `images` - 存储生成的图片信息
- `configs` - 存储应用配置
- `operation_logs` - 存储操作日志

### 🔐 API 配置详解

**获取 API Key**：
1. 访问 Nano Banana AI 官网
2. 注册账号并登录
3. 在控制台中获取 API Key
4. 确保账户有足够的余额或配额

**API 限制**：
- 请求频率限制：根据您的套餐而定
- 图片尺寸限制：最大 2048x2048
- 支持的格式：JPEG、PNG、WebP

### ☁️ OSS 配置详解

**创建 OSS 存储桶**：
1. 登录阿里云控制台
2. 进入对象存储 OSS 服务
3. 创建存储桶，选择合适的区域
4. 设置访问权限为"公共读"

**配置 CORS 规则**：
```json
{
  "allowedOrigins": ["*"],
  "allowedMethods": ["GET", "POST", "PUT", "DELETE", "HEAD", "OPTIONS"],
  "allowedHeaders": ["*"],
  "exposedHeaders": ["ETag", "x-oss-request-id"],
  "maxAgeSeconds": 0
}
```

**创建 Access Key**：
1. 进入 RAM 访问控制
2. 创建用户并授予 OSS 权限
3. 生成 Access Key ID 和 Secret
4. 记录密钥信息（仅显示一次）

## 🚀 配置验证

### 验证步骤

1. **后端服务**：访问 http://localhost:3002/api/health
2. **数据库连接**：界面显示绿色"已连接"状态
3. **API 配置**：界面显示蓝色"已配置"状态
4. **OSS 存储**：界面显示绿色"已配置"状态

### 状态指示器

- 🟢 **绿色**：服务正常运行
- 🟡 **黄色**：需要配置
- 🔴 **红色**：连接失败
- ⚪ **灰色**：未配置

## 🔍 故障排除

### 数据库连接问题

**错误：连接超时**
- 检查数据库服务器是否运行
- 验证主机地址和端口是否正确
- 确认防火墙设置允许连接

**错误：认证失败**
- 验证用户名和密码
- 检查用户权限设置
- 确认数据库是否存在

**错误：SSL 连接失败**
- 尝试禁用 SSL 连接
- 检查数据库 SSL 配置
- 验证证书是否有效

### API 连接问题

**错误：API Key 无效**
- 检查 API Key 是否正确
- 验证 API Key 是否过期
- 确认账户状态正常

**错误：请求超时**
- 检查网络连接
- 增加超时时间设置
- 验证 API 服务状态

### OSS 配置问题

**错误：403 权限错误**
- 检查 Access Key 权限
- 验证存储桶访问权限
- 确认 CORS 规则配置

**错误：存储桶不存在**
- 验证存储桶名称
- 检查区域设置
- 确认存储桶状态

## 💡 最佳实践

### 安全建议

1. **使用强密码**：数据库和 API 密钥使用复杂密码
2. **定期更换**：定期更换 API Key 和数据库密码
3. **权限最小化**：只授予必要的权限
4. **启用 SSL**：所有连接都启用 SSL/TLS 加密
5. **监控访问**：定期检查访问日志

### 性能优化

1. **选择就近区域**：选择距离用户最近的数据库和 OSS 区域
2. **连接池配置**：合理配置数据库连接池
3. **缓存策略**：启用适当的缓存机制
4. **CDN 加速**：为 OSS 配置 CDN 加速

### 成本控制

1. **监控用量**：定期检查 API 调用量和存储用量
2. **设置预警**：配置费用预警通知
3. **清理数据**：定期清理不需要的数据
4. **优化存储**：选择合适的存储类型

## 📞 技术支持

如果您在配置过程中遇到问题：

1. **查看日志**：检查浏览器控制台和后端日志
2. **测试连接**：使用界面中的测试功能
3. **检查文档**：参考官方文档和配置指南
4. **联系支持**：如需帮助，请提供详细的错误信息

---

**配置完成后，您就可以开始使用 Nano Banana AI 生成精美的图片了！** 🎨✨