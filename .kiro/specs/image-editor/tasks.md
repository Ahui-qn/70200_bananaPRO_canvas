# 图片编辑器开发任务

## 阶段一：基础框架（P0）

### Task 1: 安装依赖和创建组件结构
- [ ] 1.1 安装 Fabric.js 依赖
- [ ] 1.2 创建 ImageEditor 组件目录结构
- [ ] 1.3 创建 ImageEditor 主组件骨架
- [ ] 1.4 创建 EditorToolbar 组件
- [ ] 1.5 创建 EditorCanvas 组件

### Task 2: 实现编辑器入口
- [ ] 2.1 在画布图片右键菜单添加"编辑"选项
- [ ] 2.2 在图片详情面板添加"编辑"按钮
- [ ] 2.3 实现编辑器全屏弹窗
- [ ] 2.4 加载原图到 Canvas

### Task 3: 实现画笔工具
- [ ] 3.1 实现画笔模式切换
- [ ] 3.2 实现颜色选择器组件
- [ ] 3.3 实现画笔粗细调节
- [ ] 3.4 测试画笔绑定流畅度

### Task 4: 实现形状工具
- [ ] 4.1 实现矩形绘制工具
- [ ] 4.2 实现圆形/椭圆绘制工具
- [ ] 4.3 形状支持颜色和粗细设置
- [ ] 4.4 形状支持选择和移动

### Task 5: 实现橡皮擦工具
- [ ] 5.1 实现橡皮擦工具
- [ ] 5.2 橡皮擦大小可调节
- [ ] 5.3 只擦除绘制内容，不影响原图

### Task 6: 实现保存功能
- [ ] 6.1 实现 Canvas 导出为图片
- [ ] 6.2 调用 storageManager 上传图片
- [ ] 6.3 创建新图片记录到数据库
- [ ] 6.4 保存后图片放置在原图旁边
- [ ] 6.5 添加保存加载状态提示

## 阶段二：增强功能（P1）

### Task 7: 实现裁剪功能
- [ ] 7.1 创建裁剪遮罩组件
- [ ] 7.2 实现裁剪区域拖拽调整
- [ ] 7.3 实现裁剪预览
- [ ] 7.4 实现应用裁剪

### Task 8: 实现旋转功能
- [ ] 8.1 实现90度顺时针旋转
- [ ] 8.2 实现90度逆时针旋转
- [ ] 8.3 旋转后正确调整画布尺寸

### Task 9: 实现撤销/重做
- [ ] 9.1 创建 HistoryManager 类
- [ ] 9.2 在操作后保存状态
- [ ] 9.3 实现撤销功能
- [ ] 9.4 实现重做功能
- [ ] 9.5 添加键盘快捷键支持

### Task 10: 实现"保存并设为参考图"
- [ ] 10.1 添加"保存并设为参考图"按钮
- [ ] 10.2 保存后自动调用设置参考图接口
- [ ] 10.3 关闭编辑器后更新参考图显示

## 阶段三：优化和测试

### Task 11: 性能优化
- [ ] 11.1 大图编辑时限制 Canvas 尺寸
- [ ] 11.2 编辑器组件懒加载
- [ ] 11.3 关闭时清理资源

### Task 12: 测试
- [ ] 12.1 测试本地模式保存
- [ ] 12.2 测试云端模式保存
- [ ] 12.3 测试各工具功能
- [ ] 12.4 测试撤销/重做
- [ ] 12.5 测试大图编辑性能

## 依赖关系

```
Task 1 → Task 2 → Task 3/4/5 → Task 6
                      ↓
              Task 7/8/9/10
                      ↓
              Task 11/12
```

## 预估工时

| 阶段 | 任务 | 预估时间 |
|------|------|----------|
| 阶段一 | Task 1-6 | 5-7 小时 |
| 阶段二 | Task 7-10 | 3-4 小时 |
| 阶段三 | Task 11-12 | 1-2 小时 |
| **总计** | | **9-13 小时** |
