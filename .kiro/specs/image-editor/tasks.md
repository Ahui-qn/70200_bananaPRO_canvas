# 图片编辑器开发任务

## 阶段一：基础框架（P0）

### Task 1: 安装依赖和创建组件结构
- [x] 1.1 安装 Fabric.js 依赖
- [x] 1.2 创建 ImageEditor 组件目录结构
- [x] 1.3 创建 ImageEditor 主组件骨架
- [x] 1.4 创建 EditorToolbar 组件
- [x] 1.5 创建 EditorCanvas 组件

### Task 2: 实现编辑器入口
- [x] 2.1 在画布图片操作按钮添加"编辑"选项
- [x] 2.2 在 CanvasApp 中集成 ImageEditor 组件
- [x] 2.3 实现编辑器全屏弹窗
- [x] 2.4 加载原图到 Canvas

### Task 3: 实现画笔工具
- [x] 3.1 实现画笔模式切换
- [x] 3.2 实现颜色选择器组件
- [x] 3.3 实现画笔粗细调节
- [x] 3.4 测试画笔绑定流畅度

### Task 4: 实现形状工具
- [x] 4.1 实现矩形绘制工具
- [x] 4.2 实现圆形/椭圆绘制工具
- [x] 4.3 形状支持颜色和粗细设置
- [x] 4.4 形状支持选择和移动

### Task 5: 实现橡皮擦工具（已移除）
- [x] 5.1 ~~实现橡皮擦工具~~（功能已移除）
- [x] 5.2 ~~橡皮擦大小可调节~~（功能已移除）
- [x] 5.3 ~~只擦除绘制内容，不影响原图~~（功能已移除）

### Task 6: 实现保存功能
- [x] 6.1 实现 Canvas 导出为图片
- [x] 6.2 调用 storageManager 上传图片（通过 /api/images/upload）
- [x] 6.3 创建新图片记录到数据库
- [x] 6.4 保存后图片放置在原图旁边
- [x] 6.5 添加保存加载状态提示

## 阶段二：增强功能（P1）

### Task 7: 实现裁剪功能
- [x] 7.1 创建裁剪遮罩组件
- [x] 7.2 实现裁剪区域拖拽调整
- [x] 7.3 实现裁剪预览
- [x] 7.4 实现应用裁剪

### Task 8: 实现旋转功能
- [x] 8.1 实现90度顺时针旋转
- [x] 8.2 实现90度逆时针旋转
- [x] 8.3 旋转后正确调整画布尺寸

### Task 9: 实现撤销/重做
- [x] 9.1 创建 HistoryManager 类
- [x] 9.2 在操作后保存状态
- [x] 9.3 实现撤销功能
- [x] 9.4 实现重做功能
- [x] 9.5 添加键盘快捷键支持（Ctrl+Z / Ctrl+Shift+Z）

### Task 10: 实现"保存并设为参考图"
- [x] 10.1 添加"保存并设为参考图"按钮
- [x] 10.2 保存后自动调用设置参考图接口
- [x] 10.3 关闭编辑器后更新参考图显示

## 阶段三：优化和测试

### Task 11: 性能优化
- [x] 11.1 大图编辑时限制 Canvas 尺寸
- [x] 11.2 编辑器组件懒加载（按需渲染）
- [x] 11.3 关闭时清理资源

### Task 12: 测试
- [ ] 12.1 测试本地模式保存
- [ ] 12.2 测试云端模式保存
- [ ] 12.3 测试各工具功能
- [ ] 12.4 测试撤销/重做
- [ ] 12.5 测试大图编辑性能

## 依赖关系

```
Task 1 → Task 2 → Task 3/4/5 → Task 6
                      ↓
              Task 7/8/9/10
                      ↓
              Task 11/12
```

## 已完成功能

1. **基础编辑功能**
   - 画笔工具（支持颜色和粗细调节）
   - 矩形工具（从左上角向右下角绘制）
   - 圆形/椭圆工具（从左上角向右下角绘制）
   - 选择工具

2. **变换功能**
   - 90度顺时针/逆时针旋转
   - 撤销/重做（支持键盘快捷键）
   - 裁剪功能（可拖拽调整裁剪区域）

3. **保存功能**
   - 保存到画布（原图旁边）
   - 保存并设为参考图
   - 支持本地存储和 OSS 存储

4. **用户体验**
   - ESC 键关闭编辑器
   - 加载状态提示
   - 保存状态提示

5. **性能优化**
   - 大图编辑时限制 Canvas 尺寸（最大 2000x2000）
   - 编辑器组件懒加载
   - 关闭时清理资源

## 待完成功能

1. **测试**（Task 12）
   - 测试本地模式保存
   - 测试云端模式保存
   - 测试各工具功能
   - 测试撤销/重做
   - 测试大图编辑性能

## 已移除功能

1. **橡皮擦工具** - 根据用户反馈移除

