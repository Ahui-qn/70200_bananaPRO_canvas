# 需求文档

## 简介

本功能包含两个部分：
1. 为画布上的已生成图片添加"添加为参考图"按钮，允许用户将生成的图片直接添加到当前的参考图列表中
2. 支持拖拽调整参考图的顺序，以便用户在提示词中使用"图1"、"图2"等描述时能够灵活调整对应关系

## 术语表

- **画布图片（Canvas Image）**：显示在画布上的已生成图片
- **参考图（Reference Image）**：用户上传或添加的用于指导图片生成的参考图片
- **生成对话框（Canvas Dialog Bar）**：画布底部的输入区域，包含参考图预览和生成配置
- **UploadedImage**：前端用于表示已上传参考图的数据结构
- **参考图顺序**：参考图在列表中的排列顺序，对应提示词中的"图1"、"图2"等描述

## 需求

### 需求 1

**用户故事：** 作为用户，我希望在画布图片上看到"添加为参考图"按钮，以便我能够快速将生成的图片用作后续生成的参考。

#### 验收标准

1. WHEN 用户将鼠标悬停在画布图片上 THEN 系统 SHALL 在图片右上角显示"添加为参考图"按钮图标，位置在重新生成按钮的左边
2. WHEN 图片处于生成中状态（占位符）THEN 系统 SHALL 隐藏"添加为参考图"按钮
3. WHEN 图片处于生成失败状态 THEN 系统 SHALL 隐藏"添加为参考图"按钮
4. WHEN "添加为参考图"按钮显示时 THEN 系统 SHALL 使用与其他操作按钮一致的视觉样式

### 需求 2

**用户故事：** 作为用户，我希望点击"添加为参考图"按钮后能将图片添加到参考图列表，以便我能够在生成对话框中看到并使用它。

#### 验收标准

1. WHEN 用户点击"添加为参考图"按钮 THEN 系统 SHALL 将图片的 URL 转换为 UploadedImage 格式并添加到参考图列表
2. WHEN 图片成功添加为参考图 THEN 系统 SHALL 在生成对话框的参考图预览区域显示该图片
3. WHEN 参考图列表已满（达到最大数量限制）THEN 系统 SHALL 显示提示信息告知用户无法添加更多参考图

### 需求 3

**用户故事：** 作为用户，我希望添加参考图后能获得视觉反馈，以便我确认操作已成功执行。

#### 验收标准

1. WHEN 图片成功添加为参考图 THEN 系统 SHALL 显示短暂的成功提示信息
2. WHEN 图片添加失败 THEN 系统 SHALL 显示错误提示信息说明失败原因
3. WHEN 同一图片已存在于参考图列表中 THEN 系统 SHALL 显示提示信息告知用户该图片已添加

### 需求 4

**用户故事：** 作为用户，我希望能够拖拽调整参考图的顺序，以便我在提示词中使用"图1"、"图2"等描述时能够灵活调整对应关系。

#### 验收标准

1. WHEN 用户在参考图预览区域拖拽一张参考图 THEN 系统 SHALL 允许用户将其移动到列表中的其他位置
2. WHEN 用户释放拖拽的参考图 THEN 系统 SHALL 更新参考图列表的顺序
3. WHEN 参考图顺序改变 THEN 系统 SHALL 立即反映新的顺序，无需额外确认
4. WHEN 用户拖拽参考图时 THEN 系统 SHALL 显示视觉反馈指示当前拖拽位置

