# 实现计划

- [x] 1. 创建多选功能的核心类型和工具函数
  - [x] 1.1 创建 `frontend/src/hooks/useCanvasSelection.ts` 文件，定义选中状态管理 Hook
    - 定义 `ToolMode`、`SelectionState`、`SelectionBoxState` 类型
    - 实现选中状态的增删改查操作
    - _需求: 3.3, 4.1, 5.1, 5.2, 5.3_
  - [x] 1.2 创建 `frontend/src/utils/selectionUtils.ts` 文件，实现选区框计算和相交检测函数
    - 实现 `normalizeSelectionRect` 函数处理四象限选区框
    - 实现 `rectsIntersect` 函数检测矩形相交
    - 实现 `getIntersectingImageIds` 函数获取相交图片
    - _需求: 3.2, 3.3, 8.3_
  - [x] 1.3 编写属性测试：选区框矩形计算正确性
    - **属性 4: 选区框矩形计算正确性**
    - **验证: 需求 3.2, 8.3**
  - [x] 1.4 编写属性测试：矩形相交检测正确性
    - **属性 5: 矩形相交检测正确性**
    - **验证: 需求 3.3**

- [x] 2. 实现工具模式切换功能
  - [x] 2.1 在 `useCanvasSelection.ts` 中添加工具模式状态管理
    - 实现空格键按下/释放的状态切换
    - 实现光标样式计算逻辑
    - _需求: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3_
  - [x] 2.2 编写属性测试：空格键切换工具模式
    - **属性 2: 空格键切换工具模式**
    - **验证: 需求 2.1, 2.2, 2.3**
  - [x] 2.3 编写属性测试：抓手模式禁用选择功能
    - **属性 3: 抓手模式禁用选择功能**
    - **验证: 需求 2.4**

- [x] 3. 实现框选功能
  - [x] 3.1 创建 `frontend/src/components/SelectionBox.tsx` 组件
    - 实现选区框的渲染（半透明填充 + 虚线边框）
    - 支持动态更新位置和尺寸
    - _需求: 3.1, 3.2, 8.1_
  - [x] 3.2 在 `useCanvasSelection.ts` 中实现框选逻辑
    - 实现鼠标按下开始框选
    - 实现鼠标移动更新选区框
    - 实现鼠标释放完成框选并更新选中状态
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_
  - [x] 3.3 编写属性测试：框选结果与相交检测一致
    - **属性 6: 框选结果与相交检测一致**
    - **验证: 需求 3.3, 3.4, 3.5**

- [x] 4. 实现点击选择和 Shift 多选功能
  - [x] 4.1 在 `useCanvasSelection.ts` 中实现点击选择逻辑
    - 实现单击选中单张图片
    - 实现 Shift+点击添加/移除选中
    - 实现点击空白处清除选中
    - _需求: 4.4, 5.1, 5.2, 5.3, 5.4_
  - [x] 4.2 编写属性测试：点击选择逻辑正确性
    - **属性 8: 点击选择逻辑正确性**
    - **验证: 需求 5.1, 5.2, 5.3, 5.4**

- [x] 5. 实现批量移动功能
  - [x] 5.1 在 `useCanvasSelection.ts` 中实现批量移动逻辑
    - 实现拖动选中图片时同时移动所有选中图片
    - 实现保持图片间相对位置不变
    - 实现拖动未选中图片时清除其他选中状态
    - _需求: 6.1, 6.2, 6.3, 6.4_
  - [x] 5.2 编写属性测试：批量移动保持相对位置
    - **属性 9: 批量移动保持相对位置**
    - **验证: 需求 6.1, 6.2, 6.3**
  - [x] 5.3 编写属性测试：拖动未选中图片清除其他选择
    - **属性 10: 拖动未选中图片清除其他选择**
    - **验证: 需求 6.4**

- [x] 6. 实现键盘快捷键功能
  - [x] 6.1 在 `useCanvasSelection.ts` 中实现键盘快捷键处理
    - 实现 Delete/Backspace 删除选中图片
    - 实现 Escape 清除选中状态
    - 实现 Ctrl/Cmd+A 全选
    - _需求: 7.1, 7.2, 7.3_
  - [x] 6.2 编写属性测试：键盘快捷键功能正确性
    - **属性 11: 键盘快捷键功能正确性**
    - **验证: 需求 7.1, 7.2, 7.3**

- [x] 7. 集成到 CanvasApp 组件
  - [x] 7.1 修改 `frontend/src/CanvasApp.tsx`，集成多选功能
    - 引入 `useCanvasSelection` Hook
    - 添加空格键事件监听
    - 更新鼠标事件处理逻辑
    - 添加选区框组件渲染
    - 更新光标样式
    - _需求: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4_
  - [x] 7.2 修改 `frontend/src/components/CanvasImageLayer.tsx`，支持多选状态显示
    - 更新图片选中状态的视觉反馈
    - 支持多张图片同时显示选中边框
    - _需求: 4.1, 4.2, 4.3_
  - [x] 7.3 编写属性测试：选中状态视觉反馈一致性
    - **属性 7: 选中状态视觉反馈一致性**
    - **验证: 需求 4.1, 4.2, 4.3**

- [x] 8. 添加 CSS 样式
  - [x] 8.1 在 `frontend/src/index.css` 中添加多选相关样式
    - 添加选区框样式（半透明填充 + 虚线边框）
    - 添加多选状态的图片边框样式
    - 添加光标样式类
    - _需求: 4.1, 8.1_

- [x] 9. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。

- [x] 10. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。
