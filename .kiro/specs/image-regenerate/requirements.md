# 需求文档

## 简介

本功能为画布上的已生成图片添加"重新生成"按钮，允许用户快速复用之前的生成参数（包括参考图、提示词、宽高比、模型、尺寸和生成数量）来重新生成图片。该功能通过在图片右上角添加一个图标按钮实现，点击后自动将参数填充到生成区域，用户可以直接点击发送按钮再次生成。

## 术语表

- **画布图片（Canvas Image）**：显示在画布上的已生成图片，包含生成时使用的所有参数
- **生成参数（Generation Settings）**：用于生成图片的配置，包括提示词、模型、宽高比、尺寸、参考图等
- **参考图（Reference Images）**：用户上传的用于指导图片生成的参考图片
- **生成对话框（Canvas Dialog Bar）**：画布底部的输入区域，用于配置和触发图片生成
- **重新生成按钮（Regenerate Button）**：图片右上角的图标按钮，用于触发参数回填

## 需求

### 需求 1

**用户故事：** 作为用户，我希望在画布图片上看到重新生成按钮，以便我能够快速复用之前的生成参数。

#### 验收标准

1. WHEN 用户将鼠标悬停在画布图片上 THEN 系统 SHALL 在图片右上角显示重新生成按钮图标
2. WHEN 图片处于生成中状态（占位符）THEN 系统 SHALL 隐藏重新生成按钮
3. WHEN 图片处于生成失败状态 THEN 系统 SHALL 显示重新生成按钮以便用户重试
4. WHEN 重新生成按钮显示时 THEN 系统 SHALL 使用与其他操作按钮（收藏、下载、分享、删除）一致的视觉样式

### 需求 2

**用户故事：** 作为用户，我希望点击重新生成按钮后能自动填充所有生成参数，以便我能够快速开始新的生成。

#### 验收标准

1. WHEN 用户点击重新生成按钮 THEN 系统 SHALL 将图片的提示词填充到生成对话框的输入框中
2. WHEN 用户点击重新生成按钮 THEN 系统 SHALL 将图片的模型设置应用到生成配置中
3. WHEN 用户点击重新生成按钮 THEN 系统 SHALL 将图片的宽高比设置应用到生成配置中
4. WHEN 用户点击重新生成按钮 THEN 系统 SHALL 将图片的尺寸设置应用到生成配置中
5. WHEN 图片包含参考图信息 THEN 系统 SHALL 尝试加载并显示参考图预览

### 需求 3

**用户故事：** 作为用户，我希望参数填充后能获得视觉反馈，以便我确认操作已成功执行。

#### 验收标准

1. WHEN 参数成功填充到生成对话框 THEN 系统 SHALL 使生成对话框获得焦点
2. WHEN 参数成功填充 THEN 系统 SHALL 显示短暂的成功提示信息
3. WHEN 参考图加载失败 THEN 系统 SHALL 显示提示信息告知用户参考图无法恢复

### 需求 4

**用户故事：** 作为用户，我希望重新生成功能不会干扰我当前的操作，以便我能够安全地使用该功能。

#### 验收标准

1. WHEN 用户正在生成图片时点击重新生成按钮 THEN 系统 SHALL 阻止参数填充并显示提示
2. WHEN 用户点击重新生成按钮 THEN 系统 SHALL 保留当前已上传的参考图（如果有）并追加新的参考图
3. WHEN 生成对话框中已有内容时 THEN 系统 SHALL 用新参数替换现有内容
