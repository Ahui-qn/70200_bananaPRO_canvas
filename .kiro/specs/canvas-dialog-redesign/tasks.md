# 实现计划

- [x] 1. 创建底部对话框核心组件
  - [x] 1.1 创建 CanvasDialogBar 组件框架
    - 创建 `frontend/src/components/CanvasDialogBar.tsx`
    - 实现玻璃化 UI 样式（backdrop-filter, 圆角, 阴影）
    - 实现底部居中固定定位，最大宽度 800px
    - _需求: 2.1, 2.2, 2.3, 2.4_
  - [x] 1.2 创建 ModeSwitch 模式切换按钮组件
    - 创建模式切换按钮，默认显示"生成图片"图标
    - 实现点击展开模式列表（当前仅图片模式可用）
    - 预留视频/对话模式扩展接口
    - _需求: 3.1, 3.2, 3.3, 3.4_
  - [x] 1.3 创建 RefImageUploader 参考图上传按钮
    - 实现"+"按钮 UI
    - 实现点击打开文件选择器
    - 支持拖拽图片到输入框区域上传
    - _需求: 4.1, 4.2, 4.3_
  - [x] 1.4 编写属性测试：参考图拖拽上传
    - **属性 1: 参考图拖拽上传**
    - **验证: 需求 4.3**

- [x] 2. 实现参考图预览区域
  - [x] 2.1 创建 RefImagePreview 组件
    - 在对话框上方显示参考图预览
    - 实现横向滑动展示（overflow-x: auto）
    - 实现删除按钮功能
    - _需求: 6.1, 6.2, 6.3, 6.4_
  - [x] 2.2 编写属性测试：参考图条件渲染和删除
    - **属性 5: 参考图条件渲染**
    - **属性 6: 参考图删除**
    - **验证: 需求 6.1, 6.3**

- [x] 3. 实现提示词输入和生成按钮
  - [x] 3.1 实现提示词输入框
    - 中间区域显示输入框
    - 实现焦点状态视觉反馈
    - 支持回车触发生成
    - _需求: 5.1, 5.2_
  - [x] 3.2 实现圆形生成按钮
    - 最右侧显示圆形生成按钮（发送图标）
    - 实现渐变背景样式
    - 实现点击触发生成
    - _需求: 5.3, 5.4_
  - [x] 3.3 实现空输入验证
    - 空输入时阻止生成
    - 显示提示信息
    - _需求: 5.5_
  - [x] 3.4 编写属性测试：生成触发和空输入验证
    - **属性 3: 生成触发验证**
    - **属性 4: 空输入阻止生成**
    - **验证: 需求 5.4, 5.5**

- [x] 4. 实现配置面板
  - [x] 4.1 创建 ConfigPanel 组件
    - 实现折叠菜单按钮（三横线图标）
    - 实现卡片形式向上展开
    - 以菜单按钮为锚点定位
    - _需求: 7.1, 7.2, 7.3_
  - [x] 4.2 实现配置项
    - 模型选择下拉框
    - 尺寸选择按钮组
    - 宽高比选择网格
    - 生成数量滑动条（1-6）
    - _需求: 7.4, 7.5_
  - [x] 4.3 实现点击外部关闭
    - 点击配置面板外部区域关闭面板
    - _需求: 7.6_
  - [x] 4.4 编写属性测试：生成数量滑动条
    - **属性 7: 生成数量滑动条**
    - **验证: 需求 7.5**

- [x] 5. 重构画布布局
  - [x] 5.1 移除左侧侧边栏
    - 从 CanvasApp 中移除左侧控制面板
    - 调整画布区域为全屏布局
    - _需求: 1.1_
  - [x] 5.2 移动缩放控制组件到左下角
    - 创建 CanvasZoomControl 组件
    - 实现悬浮式 UI，玻璃化风格
    - 定位到画布左下角
    - _需求: 1.3, 1.4, 8.1, 8.2, 8.4_
  - [x] 5.3 集成底部对话框
    - 在 CanvasApp 中集成 CanvasDialogBar
    - 连接生成逻辑和状态管理
    - _需求: 1.2_
  - [x] 5.4 编写属性测试：缩放控制实时更新
    - **属性 8: 缩放控制实时更新**
    - **验证: 需求 8.3**

- [x] 6. Checkpoint - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。

- [x] 7. 实现生成状态管理
  - [x] 7.1 实现生成中状态显示
    - 在对话框区域显示生成进度
    - 禁用生成按钮和回车触发
    - 显示取消按钮
    - _需求: 9.2, 9.3, 9.4_
  - [x] 7.2 实现生成完成处理
    - 自动将生成的图片添加到画布
    - 恢复可操作状态
    - _需求: 9.5_
  - [x] 7.3 实现生成失败处理
    - 显示错误提示信息
    - 恢复可操作状态
    - _需求: 9.6_
  - [x] 7.4 编写属性测试：生成状态保护
    - **属性 9: 生成中状态保护**
    - **属性 10: 生成完成后画布更新**
    - **属性 11: 生成失败后状态恢复**
    - **验证: 需求 9.3, 9.5, 9.6**

- [x] 8. 实现图片位置计算逻辑
  - [x] 8.1 实现锚点位置计算
    - 找到最近一次生成的图片作为锚点
    - 获取锚点图片的最新位置（考虑用户拖动）
    - _需求: 10.1, 10.4_
  - [x] 8.2 实现新图片位置计算
    - 新图片排列在锚点下方
    - 批量生成时横向排列
    - 确保不与已有图片重叠
    - _需求: 10.2, 10.3, 10.5_
  - [x] 8.3 实现视角自动聚焦
    - 生成前计算并预留生成区域
    - 平滑调整视角使生成区域可见
    - _需求: 10.6, 10.7_
  - [x] 8.4 编写属性测试：位置计算
    - **属性 12: 新图片位置基于锚点计算**
    - **属性 13: 批量生成横向排列**
    - **属性 14: 生成位置不重叠**
    - **属性 15: 视角自动聚焦**
    - **验证: 需求 10.1-10.7**

- [x] 9. 样式优化和细节完善
  - [x] 9.1 优化玻璃化效果
    - 调整透明度和模糊度
    - 优化阴影效果
    - 确保在不同背景下的可读性
    - _需求: 2.1, 2.2_
  - [x] 9.2 优化响应式布局
    - 适配不同屏幕尺寸
    - 确保移动端可用性
    - _需求: 2.4_
  - [x] 9.3 优化动画效果
    - 配置面板展开/收起动画
    - 视角调整平滑动画
    - 按钮交互反馈动画
    - _需求: 10.7_

- [x] 10. Final Checkpoint - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。
