# 需求文档

## 简介

本功能为公司内部 AI 生图工具添加用户登录系统。该系统面向约 20 名内部用户，所有账号由管理员预先创建，不对外开放注册。登录功能的主要目的是识别当前使用者身份，为后续的项目管理、图片归属等功能提供用户身份基础。

## 术语表

- **用户（User）**：系统的使用者，拥有唯一的用户名和密码
- **会话（Session）**：用户登录后的状态标识，用于维持登录状态
- **认证令牌（Token）**：用于验证用户身份的加密字符串

## 需求

### 需求 1

**用户故事：** 作为内部员工，我希望通过用户名和密码登录系统，以便使用 AI 生图功能。

#### 验收标准

1. WHEN 用户输入正确的用户名和密码并点击登录按钮 THEN 系统 SHALL 验证凭据并允许用户进入主应用界面
2. WHEN 用户输入错误的用户名或密码 THEN 系统 SHALL 显示明确的错误提示"用户名或密码错误"
3. WHEN 用户输入空的用户名或密码 THEN 系统 SHALL 阻止提交并提示"请输入用户名和密码"
4. WHEN 用户尝试访问登录页面以外的任何功能且未登录 THEN 系统 SHALL 自动重定向到登录页面

### 需求 2

**用户故事：** 作为已登录用户，我希望刷新页面或重新打开应用时保持登录状态，以便无需重复登录。

#### 验收标准

1. WHEN 用户成功登录 THEN 系统 SHALL 在本地存储认证令牌以维持登录状态
2. WHEN 已登录用户刷新页面 THEN 系统 SHALL 自动验证令牌并恢复登录状态
3. WHEN 已登录用户关闭浏览器后重新打开应用 THEN 系统 SHALL 在令牌有效期内自动恢复登录状态
4. WHEN 认证令牌过期或无效 THEN 系统 SHALL 清除本地存储并重定向到登录页面

### 需求 3

**用户故事：** 作为管理员，我希望能够在后台创建和管理用户账号，以便为团队成员分配登录凭据。

#### 验收标准

1. WHEN 管理员通过命令行工具创建用户 THEN 系统 SHALL 将用户信息（用户名、加密密码、显示名称）存储到数据库
2. WHEN 创建用户时用户名已存在 THEN 系统 SHALL 拒绝创建并提示"用户名已存在"
3. WHEN 存储用户密码 THEN 系统 SHALL 使用 bcrypt 算法对密码进行加密存储
4. WHEN 查询用户列表 THEN 系统 SHALL 返回所有用户的基本信息（不包含密码）

### 需求 4

**用户故事：** 作为系统，我需要为每个用户分配唯一标识，以便后续功能能够区分不同用户的数据。

#### 验收标准

1. WHEN 创建新用户 THEN 系统 SHALL 自动生成唯一的用户 ID
2. WHEN 用户生成图片 THEN 系统 SHALL 将当前用户 ID 关联到生成的图片记录
3. WHEN 查询图片列表 THEN 系统 SHALL 能够根据用户 ID 筛选图片
4. WHEN 用户登录成功 THEN 系统 SHALL 在响应中返回用户 ID 和显示名称

### 需求 5

**用户故事：** 作为已登录用户，我希望能够退出登录，以便在共享设备上保护我的账号安全。

#### 验收标准

1. WHEN 用户点击退出登录按钮 THEN 系统 SHALL 清除本地存储的认证令牌
2. WHEN 用户退出登录 THEN 系统 SHALL 立即重定向到登录页面
3. WHEN 用户退出登录后 THEN 系统 SHALL 阻止访问任何需要登录的功能
