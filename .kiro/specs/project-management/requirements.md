# 需求文档

## 简介

本文档定义了 Nano Banana AI 绘画应用的轻量级项目管理功能需求。项目作为"生成内容的归属容器"，用于组织和管理用户生成的图片，不涉及复杂的成员、权限或流程管理。所有用户可以查看和使用所有项目。同时包含回收站功能，支持软删除和恢复。

## 术语表

- **项目（Project）**：图片生成内容的归属容器，包含名称、描述、封面等基本信息
- **项目切换器（Project Switcher）**：页面左上角的 UI 组件，用于查看项目列表、切换和创建项目
- **当前项目（Current Project）**：用户当前正在使用的项目，所有新生成的图片都会归属到该项目
- **默认项目（Default Project）**：用户首次进入应用时自动创建的项目
- **回收站（Trash）**：存放已删除项目和图片的临时区域，支持恢复操作
- **软删除（Soft Delete）**：将记录标记为已删除但不从数据库中移除
- **硬删除（Hard Delete）**：从数据库中永久移除记录
- **管理员（Admin）**：具有管理权限的用户，可以执行硬删除操作

## 需求

### 需求 1

**用户故事：** 作为用户，我希望进入应用时自动进入一个项目，这样我可以立即开始生成图片而无需先创建项目。

#### 验收标准

1. WHEN 用户首次登录且没有任何项目 THEN 系统 SHALL 自动创建一个名为"默认项目"的项目并将其设为当前项目
2. WHEN 用户登录且已有项目 THEN 系统 SHALL 自动进入用户最近使用的项目
3. WHEN 系统自动创建默认项目 THEN 系统 SHALL 将当前用户设为项目创建者

### 需求 2

**用户故事：** 作为用户，我希望在页面左上角看到项目切换器，这样我可以方便地管理和切换项目。

#### 验收标准

1. WHEN 用户进入画布页面 THEN 系统 SHALL 在页面左上角显示当前项目名称和切换按钮
2. WHEN 用户点击项目切换器 THEN 系统 SHALL 显示项目列表弹窗，使用大卡片 UI 展示所有项目
3. WHEN 显示项目列表 THEN 系统 SHALL 展示所有用户创建的项目（不包括已删除的），包括项目名称、描述、封面图、创建者和图片数量
4. WHEN 用户点击某个项目卡片 THEN 系统 SHALL 切换到该项目并关闭弹窗
5. WHEN 用户点击新建项目按钮 THEN 系统 SHALL 显示创建项目表单

### 需求 3

**用户故事：** 作为用户，我希望能够创建新项目，这样我可以将不同主题的图片分开管理。

#### 验收标准

1. WHEN 用户提交创建项目表单 THEN 系统 SHALL 创建新项目并将当前用户设为创建者
2. WHEN 创建项目时 THEN 系统 SHALL 要求用户输入项目名称（必填）和描述（可选）
3. WHEN 项目创建成功 THEN 系统 SHALL 自动切换到新创建的项目
4. WHEN 用户尝试创建同名项目 THEN 系统 SHALL 允许创建（项目名称不要求唯一）

### 需求 4

**用户故事：** 作为用户，我希望生成的图片自动关联到当前项目，这样我的图片可以按项目组织。

#### 验收标准

1. WHEN 用户生成新图片 THEN 系统 SHALL 将图片的 project_id 设置为当前项目 ID
2. WHEN 保存图片到数据库 THEN 系统 SHALL 同时保存 project_id 字段
3. WHEN 查询图片时指定 project_id THEN 系统 SHALL 只返回该项目的图片（不包括已删除的图片）

### 需求 5

**用户故事：** 作为用户，我希望切换项目后图片库只显示当前项目的图片，这样我可以专注于当前项目的内容。

#### 验收标准

1. WHEN 用户切换项目 THEN 系统 SHALL 保持画布内容不变
2. WHEN 用户打开图片库 THEN 系统 SHALL 只显示当前项目的图片（不包括已删除的图片）
3. WHEN 用户切换项目后打开图片库 THEN 系统 SHALL 显示新项目的图片列表

### 需求 6

**用户故事：** 作为用户，我希望能够编辑项目信息，这样我可以更新项目的名称和描述。

#### 验收标准

1. WHEN 用户查看自己创建的项目 THEN 系统 SHALL 显示编辑按钮
2. WHEN 用户编辑项目 THEN 系统 SHALL 允许修改项目名称和描述
3. WHEN 用户保存编辑 THEN 系统 SHALL 更新项目信息并刷新显示

### 需求 7

**用户故事：** 作为用户，我希望删除项目或图片时先进入回收站，这样我可以在误删后恢复。

#### 验收标准

1. WHEN 用户删除项目 THEN 系统 SHALL 将项目标记为已删除（软删除）并移入回收站
2. WHEN 用户删除图片 THEN 系统 SHALL 将图片标记为已删除（软删除）并移入回收站
3. WHEN 项目被软删除 THEN 系统 SHALL 同时将该项目下的所有图片标记为已删除
4. WHEN 用户删除当前正在使用的项目 THEN 系统 SHALL 在删除后自动切换到其他项目或创建新的默认项目
5. WHEN 记录被软删除 THEN 系统 SHALL 记录删除时间和删除者

### 需求 8

**用户故事：** 作为用户，我希望能够查看回收站并恢复误删的项目或图片，这样我可以找回重要内容。

#### 验收标准

1. WHEN 用户点击回收站入口 THEN 系统 SHALL 显示回收站页面，使用大卡片 UI 展示已删除的项目和图片
2. WHEN 显示回收站内容 THEN 系统 SHALL 分别展示已删除的项目和已删除的图片，显示删除时间和删除者
3. WHEN 用户点击恢复按钮 THEN 系统 SHALL 将项目或图片从回收站恢复到原位置
4. WHEN 恢复已删除的项目 THEN 系统 SHALL 同时恢复该项目下所有被级联删除的图片
5. WHEN 恢复已删除的图片 THEN 系统 SHALL 将图片恢复到其原所属项目（如果项目已删除则恢复到默认项目）

### 需求 9

**用户故事：** 作为管理员，我希望能够永久删除回收站中的内容，这样我可以清理不需要的数据。

#### 验收标准

1. WHEN 管理员查看回收站 THEN 系统 SHALL 显示永久删除按钮
2. WHEN 普通用户查看回收站 THEN 系统 SHALL 不显示永久删除按钮
3. WHEN 管理员点击永久删除 THEN 系统 SHALL 提示确认并说明此操作不可恢复
4. WHEN 管理员确认永久删除 THEN 系统 SHALL 从数据库中彻底移除记录（硬删除）
5. WHEN 管理员永久删除项目 THEN 系统 SHALL 同时永久删除该项目下所有已删除的图片

### 需求 10

**用户故事：** 作为系统，我需要支持用户角色区分，这样可以控制管理员特有的操作权限。

#### 验收标准

1. WHEN 创建用户 THEN 系统 SHALL 默认将用户角色设为普通用户
2. WHEN 检查用户权限 THEN 系统 SHALL 根据用户角色判断是否允许执行管理员操作
3. WHEN 用户角色为管理员 THEN 系统 SHALL 允许执行永久删除操作
